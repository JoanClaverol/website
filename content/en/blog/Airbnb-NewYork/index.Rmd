---
title: "AirBnb New York"
author: "Joan Claverol"
date: 2020-05-31T20:58:32+02:00
draft: true
weight: 1
output: 
  blogdown::html_page:
    toc: false
    fig_width: 8
    dev: "svg"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE, message = F, warning = F
  )
```

## Description of the problem

[...]


## Analysis

```{r libraries and data loading}
# libraries
if (require(pacman) == FALSE) {
  install.packages("pacman")
}
pacman::p_load(tidyverse, lubridate, magrittr,
               # styles to tables
               kableExtra, knitr
               )
# load data
data <- read_csv(
  "~/Downloads/268833_611395_bundle_archive/AB_NYC_2019.csv",
  col_types = cols()
  )
# define main used colour
col <- "dodgerblue4"
# caption used for all the charts 
caption <- "Airbnb listings and metrics in NYC, NY, USA (2019)"
```

```{r}
data %<>% 
  select(-last_review, - reviews_per_month) %>% 
  mutate_at(vars(name, host_name), ~if_else(is.na(.), "unknown", .))
```

```{r out.width="800px", out.height="520px"}
treshold_listing_id <- 50
top_listingIDs <- data %>% 
  group_by(host_id) %>% 
  count() %>% 
  filter(n > treshold_listing_id)
```

Probably they will be placed on the most expensive area of new York. To detect that we will create a heat map:

```{r out.width="800px", out.height="520px"}
# define outlier threshold
out_tresh <- 500
# graphs
data %>% 
  filter(price < out_tresh) %>% 
  arrange(price) %>% 
  ggplot() +
    geom_point(aes(x = longitude, y = latitude, color = price)) +
    scale_colour_gradient(low = "gray87", high = "orange") +
    labs(title = "Price heat map of Airbnb apartments",
         subtitle = paste("Prices higher than ", out_tresh ,"$ are not included", 
                          sep = ""),
         color = "Price in $", caption = caption) +
    theme_minimal()  + 
    theme(
      text = element_text(size = 13)
    ) 
```

The hypothesis seems to be correct. I can bet if we look for the places with a higher price, we will see a nice relation to this part of New York. To be able to compare the prices between different zones, we will differentiate the room types by colours:

```{r}
# plot creation
data %>%
  group_by(neighbourhood_group, room_type) %>% 
  summarise(median_price = median(price, na.rm = T), n = n()) %>%
  arrange(desc(median_price)) %>% 
  ggplot() +
    geom_point(aes(x = reorder(neighbourhood_group, median_price), 
                   y = median_price, size = n, color = room_type)) +
    coord_flip() + 
    ylab("Median price in $") +
    labs(title = "Median price by each neighbourhood group",
         subtitle = paste("The size of the points represents the quantity of",
                          "observations included\n(range from 9 to 13.000",
                          "obs.)", 
                          sep = " "),
         color = "Room type:", 
         caption = caption) +
    guides(color = guide_legend(order = 1), size = FALSE) +
    scale_color_brewer(palette = "Dark2") +
    theme_minimal() +
    theme(
      text = element_text(size = 13),
      legend.position = "top",
      legend.title = element_blank(),
      axis.title.y = element_blank()
    )
```

In that graph we are missing more information about the distribution of the data based on room type and neighbourhood group. We will use violins plots to see it:

```{r}
data %>% 
  filter(price < out_tresh) %>% 
  ggplot(aes(y = price, x = reorder(neighbourhood_group, price), 
                    fill = room_type)) + 
    geom_violin(alpha = 0.5) +
    coord_flip() + 
    facet_wrap(~room_type) +
    scale_fill_brewer(palette = "Dark2") +
    ylab("Price in $") +
    labs(title = "Price distributions in relation to neighbourhood and room type",
         subtitle = paste("The observations with a price bigger than ", out_tresh,
                          "$ has been excluded", sep = ""),
         caption = caption) +
    theme_minimal() +
    theme(
      text = element_text(size = 13),
      axis.title.y = element_blank(),
      legend.title = element_blank(),
      legend.position = "top"
    )
```
